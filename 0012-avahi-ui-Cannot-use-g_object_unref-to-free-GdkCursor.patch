From 3a88b01e459d38bbeed05d3ba8f4a1f07f34e0b8 Mon Sep 17 00:00:00 2001
From: Trent Lloyd <trent@lloyd.id.au>
Date: Thu, 16 Jan 2014 12:58:24 +0800
Subject: [PATCH] avahi-ui: Cannot use g_object_unref to free GdkCursor in GTK2

GdkCursor does not use GObject in GTK2
---
 avahi-ui/avahi-ui.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/avahi-ui/avahi-ui.c b/avahi-ui/avahi-ui.c
index ff33a89..8f90b27 100644
--- a/avahi-ui/avahi-ui.c
+++ b/avahi-ui/avahi-ui.c
@@ -890,7 +890,11 @@ static void response_callback(GtkDialog *dialog, gint response, gpointer user_da
         gtk_widget_set_sensitive(GTK_WIDGET(dialog), FALSE);
         cursor = gdk_cursor_new(GDK_WATCH);
         gdk_window_set_cursor(gtk_widget_get_window(GTK_WIDGET(dialog)), cursor);
-        g_object_unref(G_OBJECT(cursor));
+#if GTK_CHECK_VERSION(3,0,0)
+        g_object_unref(cursor);
+#else
+        gdk_cursor_unref(cursor);
+#endif
 
         if (!(d->priv->resolver = avahi_service_resolver_new(
                       d->priv->client, interface, protocol, name, type, d->priv->domain,
-- 
2.7.4

